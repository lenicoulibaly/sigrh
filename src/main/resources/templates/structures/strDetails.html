<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" 
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{structures/str-layout}">
    <head>
		<th:block layout:fragment="specific-css-links">
            <!-- Select2 -->
            <link rel="stylesheet" th:href="@{/plugins/select2/css/select2.min.css}">
            <link rel="stylesheet" th:href="@{/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css}">
            <link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
            <link rel="stylesheet" th:href="@{/plugins/select2/css/bstreeview.min.css}"/>
            <!-- DataTables -->
            <link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.css}">
        </th:block>
	</head>

	<body>
    <th:block layout:fragment="breadcrumb">
        <div class="content-header"  th:if="${str}">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-8">
                        <h1 class="m-0 text-dark">
                            <a th:href="@{'/sigrh/structures/str-details/' + ${str.strId}}">[[${str.toString()}]]</a>
                        </h1>
                    </div><!-- /.col -->
                    <div class="col-sm-4">
                        <ol class="breadcrumb float-sm-right" th:if="${viewMode} == 'details'">
                            <li class="breadcrumb-item"><a href="/sigrh/structures/str-list">Structure</a></li>
                            <li class="breadcrumb-item active"><a href="#">Details</a></li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
    </th:block>
        <div layout:fragment="content">
                    <div class="row">
                        <div class="col-md-3">
                            <!-- Profile Image -->
                            <div class="card card-primary card-outline">
                                <div class="card-body box-profile">
                                    <div class="text-center">
                                        <img class="profile-user-img img-fluid img-circle"
                                             th:src="@{/dist/img/user4-128x128.jpg}"
                                             alt="User profile picture">
                                    </div>

                                    <h3 class="profile-username text-center">Nina Mcintire</h3>

                                    <p class="text-muted text-center">Software Engineer</p>

                                    <ul class="list-group list-group-unbordered mb-3">
                                        <li class="list-group-item">
                                            <b>Followers</b> <a class="float-right">1,322</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Following</b> <a class="float-right">543</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Friends</b> <a class="float-right">13,287</a>
                                        </li>
                                    </ul>

                                    <a href="#" class="btn btn-primary btn-block"><b>Follow</b></a>
                                </div>
                                <!-- /.card-body -->
                            </div>

                            <div class="card card-primary">
                                <div class="card-header">
                                    <h3 class="card-title">Menu contextuel</h3>
                                </div>
                                <div class="card-body box-profile">
                                    <th:block th:replace="structures/contextual-menu-frag::contextual-menu"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="card card-primary card-tabs">
                                <div class="card-header p-0 pt-1 border-bottom-0">
                                    <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="custom-tabs-two-home-tab" data-toggle="pill" href="#str-details" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true">Détails</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="str-tree-tab" data-toggle="pill" href="#str-tree" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true">Structures sous tutelle</a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="pill" href="#str-personnel-list" role="tab" aria-controls="custom-tabs-two-profile" aria-selected="false">Le personnel</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="pill" href="#str-posts-list" role="tab" aria-controls="custom-tabs-two-profile" aria-selected="false">Liste des posts</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="pill" href="#modifications-story" role="tab" aria-controls="custom-tabs-two-profile" aria-selected="false">Historique des modifications</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body pt-1">
                                    <div class="tab-content" id="custom-tabs-two-tabContent">
                                        <div class="tab-pane fade show active" id="str-details" role="tabpanel" aria-labelledby="custom-tabs-two-home-tab">
                                            <table class="table table-bordered table-sm">
                                                <tr>
                                                    <td class="text-right text-bold" style="width: 50%">Le responsable</td>
                                                    <td class="text-left">[[${str.respoName}]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold" style="width: 50%">Intitulé</td>
                                                    <td class="text-left">[[${str.strName}]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold" style="width: 50%">Sigle</td>
                                                    <td class="text-left">[[${str.strSigle}]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold">Ancrage institutionnel</td>
                                                    <td><span class="text-left">[[${str.strType}]]</span></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold">Hierarchie</td>
                                                    <td><span class="text-left">
                                                        <span class="m-0 p-0">
                                                                <ol class="breadcrumb mb-1 p-1">
                                                                    <li th:each="parent, status:${str.hierarchy}" th:classappend="${status.last ? 'active' : ''}" th:title="${parent.toString()}" class="breadcrumb-item"><a th:href="'/sigrh/structures/str-details/'+${parent.strId}">[[${parent.strSigle}]]</a></li>
                                                                </ol>
                                                            </span>
                                                    </span></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold" style="width: 50%">Tel</td>
                                                    <td class="text-left">[[${str.strTel}]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold" style="width: 50%">Adresse</td>
                                                    <td class="text-left">[[${str.strAddress}]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-right text-bold">Situation géographique</td>
                                                    <td><span class="text-left">[[${str.situationGeo}]]</span></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="tab-pane fade" id="str-tree" role="tabpanel" aria-labelledby="custom-tabs-two-profile-tab">
                                            <input th:if="${str}" id="strId" th:value="${str.strId}" type="hidden">

                                            <div class="col-md-8 mx-0 p-0" style="display: inline">
                                                <table class="d-inline">
                                                    <tr>
                                                        <td >
                                                            <button id="btn-reinitialize" th:href="@{/sigrh/structures/str-list(pageNum=0, Key='')}" class="btn btn-primary" >Réinitialiser</button>
                                                        </td>
                                                        <td style="width: 500px;">

                                                            <input type="text" style="height: 40px;"  class="form-control p-0 m-0" th:value="${key}" name="key" id="key" placeholder="Rechercher une structure">

                                                        </td>
                                                        <td>
                                                            <button class="btn btn-primary" id="btn-search"><i class="fas fa-search"></i></button>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <span class="m-0 p-0">
                                                <ol class="breadcrumb mb-1 p-1 float-sm-right">
                                                    <li th:each="parent, status:${str.hierarchy}" th:classappend="${status.last ? 'active' : ''}" th:title="${parent.toString()}" class="breadcrumb-item"><a th:href="'/sigrh/structures/str-details/'+${parent.strId}">[[${parent.strSigle}]]</a></li>
                                                </ol>
                                            </span>
                                            <span id="treeview-container">

                                            </span>

                                        </div>
                                        <div class="tab-pane fade" id="str-personnel-list" role="tabpanel" aria-labelledby="custom-tabs-two-profile-tab">
                                            <table class="mt-2 table dataTable table-hover table-striped">
                                                <thead>
                                                <tr>
                                                    <th>Nom</th>
                                                    <th>Prénom</th>
                                                    <th>Matricule</th>
                                                    <th>Fixe bureau</th>
                                                    <th>Tel</th>
                                                    <th>E-mail</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr th:each="agent:${agents}">
                                                    <td>[[${agent.nom}]]</td>
                                                    <td>[[${agent.prenom}]]</td>
                                                    <td>[[${agent.matricule}]]</td>
                                                    <td>[[${agent.fixeBureau}]]</td>
                                                    <td>[[${agent.tel}]]</td>
                                                    <td>[[${agent.email}]]</td>

                                                    <td></td>
                                                </tr>
                                                </tbody>
                                            </table>

                                        </div>
                                        <div class="tab-pane fade" id="str-posts-list" role="tabpanel" aria-labelledby="custom-tabs-two-profile-tab">
                                            <table id="posts-list" class="dataTable table table-hover table-striped table-sm">
                                                <thead>
                                                <tr>
                                                    <th>Intitulé</th>
                                                    <th>Fonction</th>
                                                    <th>Structure</th>
                                                    <th>Nbr</th>
                                                    <th>OQP</th>
                                                    <th>Vacants</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr th:each="post:${posts}">
                                                    <td>[[${post.intitule}]]</td>
                                                    <td>[[${post.nomFonction}]]</td>
                                                    <td>
                                                        <span class="m-0 p-0">
                                                            <ol class="breadcrumb mb-1 p-1">
                                                                <li th:each="parent, status:${post.hierarchy}" th:classappend="${status.last ? 'active' : ''}" th:title="${parent.toString()}" class="breadcrumb-item"><a th:href="'/sigrh/structures/str-details/'+${parent.strId}">[[${parent.strSigle}]]</a></li>
                                                            </ol>
                                                        </span>
                                                    </td>
                                                    <td>[[${post.nbrPosts}]]</td>
                                                    <td >[[${post.nbrPostsOccupes}]]</td>
                                                    <td>[[${post.nbrPostsVacants}]]</td>
                                                    <td>
                                                        <a class="btn btn-sm btn-outline-warning mx-1" title="Modifier" th:href="@{/sigrh/structures/update-posts-form(postGroupId=${post.postGroupId})}"><i class="bi bi-pencil text-sm"></i> </a>
                                                        <a class="btn btn-sm btn-outline-success mx-1" title="Voir" th:href="@{'/sigrh/posts/post-details/'+${post.postGroupId}}"><i class="bi bi-eye text-sm"></i> </a>
                                                        <a class="btn btn-sm btn-outline-danger mx-1" title="Supprimer" href="#" data-toggle="modal" th:data-target="${'#delete-confirmation-modal' + str.strId}"><i class="bi bi-trash text-sm"></i></a>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="tab-pane fade" id="modifications-strory" role="tabpanel" aria-labelledby="custom-tabs-two-profile-tab">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                <tr>
                                                    <th>Intitulé du post</th>
                                                    <th>Nombre</th>
                                                    <th>Occupés</th>
                                                    <th>Vscants</th>
                                                    <th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td ></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                                <!-- /.card -->
                            </div>
                        </div>
                    </div>
        </div>
        <div layout:fragment="specific-scripts">
            <script th:src="@{/dist/js/demo.js}"></script>

            <!-- Select2 -->
            <script th:src="@{/plugins/select2/js/select2.full.min.js}"></script>
            <script th:src="@{/plugins/bootstrap-switch/js/bootstrap-switch.min.js}"></script>
            <!-- Treeview Plugin JavaScript -->
            <script th:src="@{/plugins/select2/js/bstreeview.min.js}" type="text/javascript"></script>

            <!-- DataTables -->
            <script  th:src="@{/plugins/datatables/jquery.dataTables.js}"></script>
            <script  th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.js}"></script>
            <script>
                $(function () {
                    //Initialize Select2 Elements
                    $('.select2').select2();

                    //Initialize Select2 Elements
                    $('.select2bs4').select2({theme: 'bootstrap4'});

                    //SWITCH
                    $("input[data-bootstrap-switch]").each(function(){
                        $(this).bootstrapSwitch('state', $(this).prop('checked'));
                    });
                });
            </script>
            <script>
                $("#btn-search").click(
                    e=>
                    {
                        loadStrTree($('#strId').val(), $('#key').val());
                    }
                );

                $("#btn-reinitialize").click(
                    e=>
                    {
                        $("#key").val('');
                        loadStrTree($('#strId').val(), '');
                    }
                );
                loadStrTree($('#strId').val(), '');
                function loadStrTree(strId, key)
                {
                    $.ajax({
                        url: "/sigrh/structures/loadStrTreeView/" + strId + "/"+ key,
                        success: response=>
                        {
                            $("#treeview-container").empty();
                            $("#treeview-container").append('<div id="treeview" class="col-12 treeview"></div>');
                            $('.treeview').bstreeview({
                                data: response,
                                enableLinks: true,
                                collapseIcon: "bi bi-plus-square",
                                expandIcon: "bi bi-dash-square",
                                emptyIcon: "bi bi-file"
                            });
                        }
                    });
                }

            </script>
            <script>
                $(function () {
                    $(".dataTable").DataTable(
                        {
                            "language": {
                                "lengthMenu": "Affiche _MENU_ enregistrements par page",
                                "zeroRecords": "Aucun agent trouvé",
                                "info": "Showing page _PAGE_ of _PAGES_",
                                "infoEmpty": "",
                                "infoFiltered": "(filtered from _MAX_ total records)",
                                "search": "Rechercher"
                            }
                        }
                    );
                    /*$('#posts-list').DataTable({
                        "paging": true,
                        "lengthChange": false,
                        "searching": false,
                        "ordering": true,
                        "info": true,
                        "autoWidth": false,
                    });*/
                });
            </script>
        </div>
    </body>
</html>